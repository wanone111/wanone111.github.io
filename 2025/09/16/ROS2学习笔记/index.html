<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS2 | Welcome to Wanone111's Blog</title><meta name="author" content="wanone111"><meta name="copyright" content="wanone111"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一键下载ros，这里使用的是鱼香ROS的代码1wget http:&#x2F;&#x2F;fishros.com&#x2F;install -O fishros &amp;&amp; . fishros  RCLCPPRCLCPP 是 ROS2 的 C++ 客户端库的名称（ros client library for c++） 日志ROS2将日志分为五个等级 12345RCLCPP_DEBUG(this-&gt;get_log">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS2">
<meta property="og:url" content="http://wanone111.github.io/2025/09/16/ROS2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Welcome to Wanone111&#39;s Blog">
<meta property="og:description" content="一键下载ros，这里使用的是鱼香ROS的代码1wget http:&#x2F;&#x2F;fishros.com&#x2F;install -O fishros &amp;&amp; . fishros  RCLCPPRCLCPP 是 ROS2 的 C++ 客户端库的名称（ros client library for c++） 日志ROS2将日志分为五个等级 12345RCLCPP_DEBUG(this-&gt;get_log">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://wanone111.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-09-16T13:58:34.000Z">
<meta property="article:modified_time" content="2025-09-18T01:51:01.868Z">
<meta property="article:author" content="wanone111">
<meta property="article:tag" content="ROS2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://wanone111.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ROS2",
  "url": "http://wanone111.github.io/2025/09/16/ROS2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
  "image": "http://wanone111.github.io/img/butterfly-icon.png",
  "datePublished": "2025-09-16T13:58:34.000Z",
  "dateModified": "2025-09-18T01:51:01.868Z",
  "author": [
    {
      "@type": "Person",
      "name": "wanone111",
      "url": "http://wanone111.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://wanone111.github.io/2025/09/16/ROS2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS2',
  isHighlightShrink: true,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/../pic/background.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/../pic/%E9%87%91%E6%AF%9B.png" alt="Logo"><span class="site-name">Welcome to Wanone111's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">ROS2</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ROS2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-16T13:58:34.000Z" title="发表于 2025-09-16 21:58:34">2025-09-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-18T01:51:01.868Z" title="更新于 2025-09-18 09:51:01">2025-09-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ROS2/">ROS2</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="一键下载ros，这里使用的是鱼香ROS的代码"><a href="#一键下载ros，这里使用的是鱼香ROS的代码" class="headerlink" title="一键下载ros，这里使用的是鱼香ROS的代码"></a>一键下载ros，这里使用的是鱼香ROS的代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//fishros.com/install -O fishros &amp;&amp; . fishros</span></span><br></pre></td></tr></table></figure>

<h2 id="RCLCPP"><a href="#RCLCPP" class="headerlink" title="RCLCPP"></a>RCLCPP</h2><p>RCLCPP 是 ROS2 的 C++ 客户端库的名称（ros client library for c++）</p>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>ROS2将日志分为五个等级</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RCLCPP_DEBUG(this-&gt;get_logger(), <span class="string">&quot;我是DEBUG级别的日志，我被打印出来了!&quot;</span>);</span><br><span class="line">RCLCPP_INFO(this-&gt;get_logger(), <span class="string">&quot;我是INFO级别的日志，我被打印出来了!&quot;</span>);</span><br><span class="line">RCLCPP_WARN(this-&gt;get_logger(), <span class="string">&quot;我是WARN级别的日志，我被打印出来了!&quot;</span>);</span><br><span class="line">RCLCPP_ERROR(this-&gt;get_logger(), <span class="string">&quot;我是ERROR级别的日志，我被打印出来了!&quot;</span>);</span><br><span class="line">RCLCPP_FATAL(this-&gt;get_logger(), <span class="string">&quot;我是FATAL级别的日志，我被打印出来了!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="节点，话题，服务-参数，动作"><a href="#节点，话题，服务-参数，动作" class="headerlink" title="节点，话题，服务,参数，动作"></a>节点，话题，服务,参数，动作</h2><h3 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h3><h4 id="节点的概念"><a href="#节点的概念" class="headerlink" title="节点的概念"></a>节点的概念</h4><p>一个节点只负责一个单独的模块化功能，如一个节点负责控制车轮转动，一个节点负责从雷达获取数据，一个节点负责处理雷达数据…<br>特点是：<br><strong>执行某些具体的任务；</strong><br><strong>每一个节点独立运行的可执行文件</strong>；<br><strong>节点编程语言可以不同；</strong><br><strong>节点处在的位置可以是位于硬件上，也可以位于云端；</strong><br><strong>节点是唯一命名的，便于查询节点的状态等。</strong></p>
<h4 id="节点间的通信"><a href="#节点间的通信" class="headerlink" title="节点间的通信"></a>节点间的通信</h4><p>ROS2中节点有四种通信方式</p>
<p><strong>话题-topics</strong><br><strong>服务-services</strong><br><strong>参数-parameters</strong><br><strong>动作-Action</strong></p>
<h4 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h4><p>1.编程接口初始化<br>2.创建节点并初始化<br>3.实现节点功能<br>4.销毁节点并关闭接口</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  创建一个HelloWorld的节点，节点功能为输出Helloworld的日志</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span>   <span class="comment">//ros2的头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  创建一个类节点，名字叫做helloworldNode,继承自Node</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">helloworldNode</span>: <span class="keyword">public</span> rclcpp::Node </span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">serial_test</span>(std::string name):<span class="built_in">Node</span>() <span class="comment">//这里的std::string  表示std作用域下的string类型 </span></span><br><span class="line"> &#123;</span><br><span class="line">   <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">&quot;say %s&quot;</span>,name.<span class="built_in">c_str</span>()) <span class="comment">//类似于printf</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);<span class="comment">//初始化ros2</span></span><br><span class="line">    <span class="comment">/*产生一个helloworld的节点</span></span><br><span class="line"><span class="comment">      auto 自动类型推断，让编译器自动决定node类型    </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;helloworld&gt;(<span class="string">&quot;helloworld&quot;</span>);</span><br><span class="line">    <span class="comment">/* 运行节点，并检测退出信号*/</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);<span class="comment">//使ros2节点node进入事件循环，处理信息，回调和定时器任务，直到节点关闭，相当于节点的主循环</span></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();<span class="comment">//程序结束</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编译运行节点"><a href="#编译运行节点" class="headerlink" title="编译运行节点"></a>编译运行节点</h4><p>在编译节点时，需要更改CmakeLists.txt中的内容</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_executable(helloworld_node src/serial_test.cpp) //定义了一个可执行文件helloworld_node 其源代码文件为src/serial_test.cpp</span><br><span class="line">ament_target_dependencies(helloworld_node rclcpp) //指定helloworld_node这个目标依赖于rclcpp这个库</span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">  helloworld_node</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)    //安装可执行文件到ros2的lib/包名的目录下，$&#123;PROJECT_NAME&#125;表示CMake变量</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="节点需要注意"><a href="#节点需要注意" class="headerlink" title="节点需要注意"></a>节点需要注意</h4><p>在编写程序中，首先创建一个工作空间，在工作空间下去创建功能包，一个功能包可以有多个节点.<br>我们在编译时，是在工作空间去执行编译任务的</p>
<h3 id="话题"><a href="#话题" class="headerlink" title="话题"></a>话题</h3><h4 id="话题的概念"><a href="#话题的概念" class="headerlink" title="话题的概念"></a>话题的概念</h4><p>ros2中话题（Topic）是一种节点间传输数据的一种方式<br>其特点为单向传输，异步<br>节点（Node）通过订阅（Subscribe）另一个（Node）发布（Publish）的话题（Topic）来接收数据<br>发布者发布一个话题，将数据发布到话题上，订阅者通过话题查看发布的内容<br>发布者发出数据后，并不知道订阅者什么时候接到，只发，适合一些周期发布的数据<br>话题的发布可以是1V1，1Vn,nV1,nVn</p>
<h4 id="创建话题"><a href="#创建话题" class="headerlink" title="创建话题"></a>创建话题</h4><p>创建话题流程</p>
<table>
<thead>
<tr>
<th>发布者</th>
<th>订阅者</th>
</tr>
</thead>
<tbody><tr>
<td>1.编程接口初始化</td>
<td>1.编程接口初始化</td>
</tr>
<tr>
<td>2. 创建节点并初始化</td>
<td>2. 创建节点并初始化</td>
</tr>
<tr>
<td>3. 创建发布者对象</td>
<td>3. 创建订阅者对象</td>
</tr>
<tr>
<td>4. 创建并填充话题消息</td>
<td>4. 回调函数处理话题数据</td>
</tr>
<tr>
<td>5. 发布话题消息</td>
<td>5. 销毁节点并关闭接口</td>
</tr>
<tr>
<td>6. 销毁节点并关闭接口</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">topic_publisher</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/string.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopicPublisher01</span> : <span class="keyword">public</span> rclcpp::Node <span class="comment">//定义一个类，这个类继承自 rclcpp::Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 构造函数,有一个参数为节点名称</span></span><br><span class="line">    <span class="built_in">TopicPublisher01</span>(std::string name) : <span class="built_in">Node</span>(name)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;大家好，我是%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="comment">// 创建发布者 在名为command发布std_msgs::msg::String类型的信息 10为队列大小，意义为本地信息队列缓存10条信息</span></span><br><span class="line">        command_publisher_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::String&gt;(<span class="string">&quot;command&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 创建定时器，500ms为周期，定时发布 由回调周期，回调函数，调用回调函数所在的回调组组成，默认为nullptr</span></span><br><span class="line">        timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>), std::<span class="built_in">bind</span>(&amp;TopicPublisher01::timer_callback, <span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">timer_callback</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 创建消息</span></span><br><span class="line">        std_msgs::msg::String message;</span><br><span class="line">        message.data = <span class="string">&quot;forward&quot;</span>;</span><br><span class="line">        <span class="comment">// 日志打印</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Publishing: &#x27;%s&#x27;&quot;</span>, message.data.<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="comment">// 将 message 通过发布者发布到 command 话题中。 </span></span><br><span class="line">        command_publisher_-&gt;<span class="built_in">publish</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 声名定时器指针</span></span><br><span class="line">    rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">    <span class="comment">// 声明话题发布者指针</span></span><br><span class="line">    rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr command_publisher_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="comment">/*创建对应节点的共享指针对象*/</span></span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;TopicPublisher01&gt;(<span class="string">&quot;topic_publisher_01&quot;</span>);</span><br><span class="line">    <span class="comment">/* 运行节点，并检测退出信号*/</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">topic_subscriber</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/msg/string.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopicSubscribe01</span> : <span class="keyword">public</span> rclcpp::Node <span class="comment">//定义一个类，这个类继承自 rclcpp::Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TopicSubscribe01</span>(std::string name) : <span class="built_in">Node</span>(name) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;大家好，我是%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">          <span class="comment">// 创建了一个订阅 command 话题、消息类型为 std_msgs::msg::String 的订阅者，并指定回调函数处理收到的消息。</span></span><br><span class="line">        command_subscribe_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::String&gt;(<span class="string">&quot;command&quot;</span>, <span class="number">10</span>, std::<span class="built_in">bind</span>(&amp;TopicSubscribe01::command_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">     <span class="comment">// 声明一个订阅者</span></span><br><span class="line">    rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr command_subscribe_;</span><br><span class="line">     <span class="comment">// 收到话题数据的回调函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">command_callback</span><span class="params">(<span class="type">const</span> std_msgs::msg::String::SharedPtr msg)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">double</span> speed = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="keyword">if</span>(msg-&gt;data == <span class="string">&quot;forward&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            speed = <span class="number">0.2f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;收到[%s]指令，发送速度 %f&quot;</span>, msg-&gt;data.<span class="built_in">c_str</span>(),speed);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="comment">/*创建对应节点的共享指针对象*/</span></span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;TopicSubscribe01&gt;(<span class="string">&quot;topic_subscribe_01&quot;</span>);</span><br><span class="line">    <span class="comment">/* 运行节点，并检测退出信号*/</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">create_publisher</span>() 发布消息到话题</span><br><span class="line">command_publisher_-&gt;<span class="built_in">publish</span>(message); 发布消息（message）到话题上</span><br><span class="line"><span class="built_in">create_subscription</span>() 订阅某个话题</span><br></pre></td></tr></table></figure>

<h4 id="编译运行话题"><a href="#编译运行话题" class="headerlink" title="编译运行话题"></a>编译运行话题</h4><p>编译话题<br>首先是CMakeLists.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">find_package(rclcpp REQUIRED)</span><br><span class="line">find_package(std_msgs REQUIRED)</span><br><span class="line"></span><br><span class="line">add_executable(topic_publisher_01 src/topic_publisher_01.cpp)</span><br><span class="line">add_executable(topic_subscribe_01 src/topic_subscribe_01.cpp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ament_target_dependencies(topic_publisher_01 rclcpp std_msgs)</span><br><span class="line">ament_target_dependencies(topic_subscribe_01 rclcpp std_msgs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">  topic_publisher_01</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">topic_subscribe_01</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后是packages.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在运行话题中，可以使用rqt_graph来查看节点的关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph</span><br></pre></td></tr></table></figure>

<h4 id="话题需要注意"><a href="#话题需要注意" class="headerlink" title="话题需要注意"></a>话题需要注意</h4><p>话题名字是关键,发布订阅接口类型要相同，发布的是字符串，接受也要用字符串来接收;<br>同一个人(节点)可以订阅多个话题，同时也可以发布多个话题，就像一本书的作者也可以是另外一本书的读者;<br>同一个小说不能有多个作者（版权问题），但跟小说不一样，同一个话题可以有多个发布者。</p>
<h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><h4 id="服务的概念"><a href="#服务的概念" class="headerlink" title="服务的概念"></a>服务的概念</h4><p>ros2中另一个常用的通信方法为服务，适用于同步性要求更高的数据<br>创建两个节点，一个为服务端，一个为客户端，客户端在需要某些数据时，针对某个具体服务，发送请求信息，服务器端收到请求之后，就会进行处理并反馈应答信息，即为一问一答的形式。</p>
<h4 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h4><p>创建服务流程</p>
<table>
<thead>
<tr>
<th>发布者</th>
<th>订阅者</th>
</tr>
</thead>
<tbody><tr>
<td>1.编程接口初始化</td>
<td>1.编程接口初始化</td>
</tr>
<tr>
<td>2. 创建节点并初始化</td>
<td>2. 创建节点并初始化</td>
</tr>
<tr>
<td>3. 创建服务器端对象</td>
<td>3. 创建客户端对象</td>
</tr>
<tr>
<td>4. 通过回调函数进行服务</td>
<td>4. 创建并发送请求数据</td>
</tr>
<tr>
<td>5. 向客户端反馈应答结果</td>
<td>5. 等待服务器端应答数据</td>
</tr>
<tr>
<td>6. 销毁节点并关闭接口</td>
<td>6.销毁节点并关闭接口</td>
</tr>
</tbody></table>
<p>以两数相加的服务为例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceServer01</span> : <span class="keyword">public</span> rclcpp::Node &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ServiceServer01</span>(std::string name) : <span class="built_in">Node</span>(name) &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;节点已启动：%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// 创建一个服务，服务类型为 AddTwoInts，名为 &quot;add_two_ints_srv&quot;,指定收到请求时由 handle_add_two_ints 函数处理，使用 std::bind 绑定成员函数。</span></span><br><span class="line">    <span class="comment">//向ROS2系统注册名为 &quot;add_two_ints_srv&quot; 的服务，并指定收到请求时的处理函数</span></span><br><span class="line">    add_ints_server_ =</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">create_service</span>&lt;example_interfaces::srv::AddTwoInts&gt;(</span><br><span class="line">        <span class="string">&quot;add_two_ints_srv&quot;</span>,</span><br><span class="line">        std::<span class="built_in">bind</span>(&amp;ServiceServer01::handle_add_two_ints, <span class="keyword">this</span>,</span><br><span class="line">                  std::placeholders::_1, std::placeholders::_2));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// 声明一个服务</span></span><br><span class="line">  rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr</span><br><span class="line">    add_ints_server_;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 收到请求的处理函数</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">handle_add_two_ints</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Request&gt; request,</span></span></span><br><span class="line"><span class="params"><span class="function">    std::shared_ptr&lt;example_interfaces::srv::AddTwoInts::Response&gt; response)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;收到a: %ld b: %ld&quot;</span>, request-&gt;a,</span><br><span class="line">                request-&gt;b);</span><br><span class="line">    response-&gt;sum = request-&gt;a + request-&gt;b;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;ServiceServer01&gt;(<span class="string">&quot;service_server_01&quot;</span>);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/srv/add_two_ints.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServiceClient01</span> : <span class="keyword">public</span> rclcpp::Node &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// 构造函数，初始化节点名称，并创建一个客户端，连接到 add_two_ints_srv 服务。</span></span><br><span class="line">  <span class="built_in">ServiceClient01</span>(std::string name) : <span class="built_in">Node</span>(name) &#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;节点已启动：%s.&quot;</span>, name.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// 创建一个名为 &quot;add_two_ints_srv&quot; 的服务客户端，准备与同名服务连接和通讯</span></span><br><span class="line">    client_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_client</span>&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">&quot;add_two_ints_srv&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">send_request</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;计算%d+%d&quot;</span>, a, b);     <span class="comment">//发起加法请求，并打印要计算的数据。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.等待服务端上线</span></span><br><span class="line">    <span class="keyword">while</span> (!client_-&gt;<span class="built_in">wait_for_service</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">      <span class="comment">//等待时检测rclcpp的状态</span></span><br><span class="line">      <span class="keyword">if</span> (!rclcpp::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;等待服务的过程中被打断...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;等待服务端上线中&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建请求对象，并把要相加的数字赋值给请求。</span></span><br><span class="line">    <span class="keyword">auto</span> request =</span><br><span class="line">      std::<span class="built_in">make_shared</span>&lt;example_interfaces::srv::AddTwoInts_Request&gt;();</span><br><span class="line">    request-&gt;a = a;</span><br><span class="line">    request-&gt;b = b;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.发送异步请求，然后等待返回，返回时调用回调函数 向服务端异步发送请求（即真正触发一次服务调用）</span></span><br><span class="line">    client_-&gt;<span class="built_in">async_send_request</span>(</span><br><span class="line">      request, std::<span class="built_in">bind</span>(&amp;ServiceClient01::result_callback_, <span class="keyword">this</span>,</span><br><span class="line">                         std::placeholders::_1));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// 声明客户端</span></span><br><span class="line">  rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr client_;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">result_callback_</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    rclcpp::Client&lt;example_interfaces::srv::AddTwoInts&gt;::SharedFuture</span></span></span><br><span class="line"><span class="params"><span class="function">      result_future)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> response = result_future.<span class="built_in">get</span>();</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;计算结果：%ld&quot;</span>, response-&gt;sum);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  <span class="comment">/*创建对应节点的共享指针对象*/</span></span><br><span class="line">  <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;ServiceClient01&gt;(<span class="string">&quot;service_client_01&quot;</span>);</span><br><span class="line">  <span class="comment">/* 运行节点，并检测退出信号*/</span></span><br><span class="line">  <span class="comment">//增加这一行，node-&gt;send_request(5, 6);，计算5+6结果</span></span><br><span class="line">  node-&gt;<span class="built_in">send_request</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心代码为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create_service 和 create_client 里用的是同一个服务名和服务类型</span><br><span class="line"><span class="built_in">create_service</span>&lt;类型&gt;(<span class="string">&quot;服务名&quot;</span>, 回调)</span><br><span class="line"><span class="built_in">create_client</span>&lt;类型&gt;(<span class="string">&quot;服务名&quot;</span>),<span class="built_in">async_send_request</span>(...)</span><br></pre></td></tr></table></figure>

<h4 id="编译运行服务"><a href="#编译运行服务" class="headerlink" title="编译运行服务"></a>编译运行服务</h4><p>编译服务<br>首先是CMakeLists.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">find_package(example_interfaces REQUIRED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_executable(service_client_01 src/client_01.cpp)</span><br><span class="line">ament_target_dependencies(service_client_01 rclcpp example_interfaces)</span><br><span class="line"></span><br><span class="line">add_executable(service_server_01 src/server_01.cpp)</span><br><span class="line">ament_target_dependencies(service_server_01 rclcpp example_interfaces)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">  service_server_01</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">install(TARGETS</span><br><span class="line">  service_client_01</span><br><span class="line">  DESTINATION lib/$&#123;PROJECT_NAME&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然后是packages.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">depend</span>&gt;</span>example_interfaces<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="服务需要注意"><a href="#服务需要注意" class="headerlink" title="服务需要注意"></a>服务需要注意</h4><p>同一个服务（名称相同）有且只能有一个节点来提供<br>同一个服务可以被多个客户端调用</p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><h4 id="参数的概念"><a href="#参数的概念" class="headerlink" title="参数的概念"></a>参数的概念</h4><p>参数是节点的一个配置值，你可以认为参数是一个节点的设置<br>ROS2参数是由键值对组成的<br>ROS2支持的参数值的类型如下：</p>
<p>bool 和bool[]，布尔类型用来表示开关，比如我们可以控制雷达控制节点，开始扫描和停止扫描。<br>int64 和int64[]，整形表示一个数字，含义可以自己来定义，这里我们可以用来表示李四节点写小说的周期值<br>float64 和float64[]，浮点型，可以表示小数类型的参数值<br>string 和string[]，字符串，可以用来表示雷达控制节点中真实雷达的ip地址<br>byte[]，字节数组，这个可以用来表示图片，点云数据等信息</p>
<h4 id="参数的使用"><a href="#参数的使用" class="headerlink" title="参数的使用"></a>参数的使用</h4><p>把参数存起来其实就相当去把当前的参数值拍一张快照，然后保存下来，后面可以用于恢复参数到当前的数值。<br>可以使用下面的命令进行操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 param dump &lt;node_name&gt;</span><br></pre></td></tr></table></figure>

<p>然后文件被保存成了yaml格式。在下次启动节点时，可以使用</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ros2</span> <span class="string">run</span> <span class="string">&lt;package_name&gt;</span> <span class="string">&lt;executable_name&gt;</span> <span class="string">--ros-args</span> <span class="string">--params-file</span> <span class="string">&lt;file_name&gt;</span></span><br></pre></td></tr></table></figure>

<p>操作参数的函数</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>declare_parameter</td>
<td>声明和初始化一个参数</td>
</tr>
<tr>
<td>declare_parameters</td>
<td>声明和初始化一堆参数</td>
</tr>
<tr>
<td>get_parameter</td>
<td>通过参数名字获取一个参数</td>
</tr>
<tr>
<td>get_parameters</td>
<td>获取具有给定前缀的所有参数的参数值</td>
</tr>
<tr>
<td>set_parameters</td>
<td>设置一组参数的值</td>
</tr>
</tbody></table>
<p>构造声明参数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//声明参数</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>&lt;std::<span class="type">uint32_t</span>&gt;(<span class="string">&quot;parameter&quot;</span>, a);</span><br></pre></td></tr></table></figure>

<p>获取并声明参数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新参数</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">get_parameter</span>(<span class="string">&quot;parameter&quot;</span>,a);</span><br></pre></td></tr></table></figure>

<h4 id="编译运行参数"><a href="#编译运行参数" class="headerlink" title="编译运行参数"></a>编译运行参数</h4><p>参数是与节点搭配使用的，与节点编译运行操作相似</p>
<h3 id="动作（Action）"><a href="#动作（Action）" class="headerlink" title="动作（Action）"></a>动作（Action）</h3><h4 id="Action的概念"><a href="#Action的概念" class="headerlink" title="Action的概念"></a>Action的概念</h4><p>Action的三大组成部分目标、反馈和结果</p>
<p>目标：即Action客户端告诉服务端要做什么，服务端针对该目标要有响应。解决了不能确认服务端接收并处理目标问题</p>
<p>反馈：即Action服务端告诉客户端此时做的进度如何（类似与工作汇报）。解决执行过程中没有反馈问题</p>
<p>结果：即Action服务端最终告诉客户端其执行结果，结果最后返回，用于表示任务最终执行情况。</p>
<p>参数是由服务构建出来了，而Action是由话题和服务共同构建出来的（一个Action &#x3D; 三个服务+两个话题）<br>三个服务分别是：1.目标传递服务 2.结果传递服务 3.取消执行服务<br>两个话题：1.反馈话题（服务发布，客户端订阅） 2.状态话题（服务端发布，客户端订阅）</p>
<h4 id="Action的使用"><a href="#Action的使用" class="headerlink" title="Action的使用"></a>Action的使用</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">服务端</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/action/fibonacci.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="comment">// TODO(jacobperron): Remove this once it is included as part of &#x27;rclcpp.hpp&#x27;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_action/rclcpp_action.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个ActionServer类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalActionServer</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> Fibonacci = example_interfaces::action::Fibonacci;</span><br><span class="line">  <span class="keyword">using</span> GoalHandleFibonacci = rclcpp_action::ServerGoalHandle&lt;Fibonacci&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MinimalActionServer</span><span class="params">(<span class="type">const</span> rclcpp::NodeOptions &amp; options = rclcpp::NodeOptions())</span></span></span><br><span class="line"><span class="function">  : Node(<span class="string">&quot;minimal_action_server&quot;</span>, options) //定义了构造函数，调用基类Node构造函数，节点名叫<span class="string">&quot;minimal_action_server&quot;</span>，并接收可选的节点参数。</span></span><br><span class="line"><span class="function">  &#123;</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;<span class="comment">//进入构造函数体，使用std::placeholders中的占位符，用来绑定成员函数。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;action_server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Fibonacci&gt;(   <span class="comment">//创建一个Fibonacci类型的Action服务器，赋给成员变量action_server_</span></span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_base_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_clock_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_logging_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_waitables_interface</span>(), <span class="comment">//创建接口</span></span><br><span class="line">      <span class="string">&quot;fibonacci&quot;</span>, <span class="comment">//Action的名字是&quot;fibonacci&quot;</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_goal, <span class="keyword">this</span>, _1, _2),<span class="comment">//绑定三个回调函数，handle_goal：收到新Goal时调用</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_cancel, <span class="keyword">this</span>, _1),<span class="comment">//handle_cancel：收到取消Goal请求时调用</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_accepted, <span class="keyword">this</span>, _1)); <span class="comment">//handle_accepted：Goal被接受后调用，负责执行Goal的计算</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Server&lt;Fibonacci&gt;::SharedPtr action_server_; <span class="comment">//定义Action服务器的智能指针成员变量，用来管理Action服务器生命周期。</span></span><br><span class="line"></span><br><span class="line">  <span class="function">rclcpp_action::GoalResponse <span class="title">handle_goal</span><span class="params">(  <span class="comment">//定义收到Goal请求时调用的函数，接收Goal的唯一ID和Goal消息。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> rclcpp_action::GoalUUID &amp; uuid,</span></span></span><br><span class="line"><span class="params"><span class="function">    std::shared_ptr&lt;<span class="type">const</span> Fibonacci::Goal&gt; goal)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Received goal request with order %d&quot;</span>, goal-&gt;order); <span class="comment">//打印日志，显示接收到的Fibonacci数列阶数order。</span></span><br><span class="line">    (<span class="type">void</span>)uuid;</span><br><span class="line">    <span class="comment">// Let&#x27;s reject sequences that are over 9000</span></span><br><span class="line">    <span class="keyword">if</span> (goal-&gt;order &gt; <span class="number">9000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> rclcpp_action::GoalResponse::REJECT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">rclcpp_action::CancelResponse <span class="title">handle_cancel</span><span class="params">( <span class="comment">//定义收到取消请求时调用的函数，带有Goal句柄。</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Received request to cancel goal&quot;</span>);<span class="comment">//打印日志，收到取消Goal请求。</span></span><br><span class="line">    (<span class="type">void</span>)goal_handle;</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::CancelResponse::ACCEPT;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span> <span class="comment">//定义执行Goal时的具体计算函数，异步执行Fibonacci计算和反馈发布。</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Executing goal&quot;</span>);</span><br><span class="line">    <span class="function">rclcpp::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;  <span class="comment">//定义频率为1Hz的循环器，控制执行过程的节奏。</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> goal = goal_handle-&gt;<span class="built_in">get_goal</span>(); <span class="comment">//获取Goal消息指针。</span></span><br><span class="line">    <span class="keyword">auto</span> feedback = std::<span class="built_in">make_shared</span>&lt;Fibonacci::Feedback&gt;(); <span class="comment">//创建反馈消息智能指针。</span></span><br><span class="line">    <span class="keyword">auto</span> &amp; sequence = feedback-&gt;sequence; <span class="comment">//引用反馈消息中的数列容器。</span></span><br><span class="line">    sequence.<span class="built_in">push_back</span>(<span class="number">0</span>);<span class="comment">//初始化Fibonacci数列的前2个数字0和1</span></span><br><span class="line">    sequence.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> result = std::<span class="built_in">make_shared</span>&lt;Fibonacci::Result&gt;(); <span class="comment">//创建结果消息智能指针。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; (i &lt; goal-&gt;order) &amp;&amp; rclcpp::<span class="built_in">ok</span>(); ++i) &#123;</span><br><span class="line">      <span class="comment">// Check if there is a cancel request</span></span><br><span class="line">      <span class="keyword">if</span> (goal_handle-&gt;<span class="built_in">is_canceling</span>()) &#123;</span><br><span class="line">        result-&gt;sequence = sequence;</span><br><span class="line">        goal_handle-&gt;<span class="built_in">canceled</span>(result);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal Canceled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Update sequence</span></span><br><span class="line">      sequence.<span class="built_in">push_back</span>(sequence[i] + sequence[i - <span class="number">1</span>]);</span><br><span class="line">      <span class="comment">// Publish feedback</span></span><br><span class="line">      goal_handle-&gt;<span class="built_in">publish_feedback</span>(feedback);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Publish Feedback&quot;</span>);</span><br><span class="line"></span><br><span class="line">      loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if goal is done</span></span><br><span class="line">    <span class="keyword">if</span> (rclcpp::<span class="built_in">ok</span>()) &#123;</span><br><span class="line">      result-&gt;sequence = sequence;</span><br><span class="line">      goal_handle-&gt;<span class="built_in">succeed</span>(result);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal Succeeded&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">handle_accepted</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GoalHandleFibonacci&gt; goal_handle)</span> <span class="comment">//Goal被接受后的回调函数。</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders; <span class="comment">//使用占位符命名空间。</span></span><br><span class="line">    <span class="comment">// this needs to return quickly to avoid blocking the executor, so spin up a new thread</span></span><br><span class="line">    std::thread&#123;std::<span class="built_in">bind</span>(&amp;MinimalActionServer::execute, <span class="keyword">this</span>, _1), goal_handle&#125;.<span class="built_in">detach</span>(); <span class="comment">//用新的线程调用execute方法执行计算，detach线程让其后台运行</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;  <span class="comment">// class MinimalActionServer</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> action_server = std::<span class="built_in">make_shared</span>&lt;MinimalActionServer&gt;();</span><br><span class="line"></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(action_server);</span><br><span class="line"></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">客户端</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;example_interfaces/action/fibonacci.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp/rclcpp.hpp&quot;</span></span></span><br><span class="line"><span class="comment">// TODO(jacobperron): Remove this once it is included as part of &#x27;rclcpp.hpp&#x27;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rclcpp_action/rclcpp_action.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalActionClient</span> : <span class="keyword">public</span> rclcpp::Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">using</span> Fibonacci = example_interfaces::action::Fibonacci;</span><br><span class="line">  <span class="keyword">using</span> GoalHandleFibonacci = rclcpp_action::ClientGoalHandle&lt;Fibonacci&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MinimalActionClient</span><span class="params">(<span class="type">const</span> rclcpp::NodeOptions &amp; node_options = rclcpp::NodeOptions())</span></span></span><br><span class="line"><span class="function">  : Node(<span class="string">&quot;minimal_action_client&quot;</span>, node_options), goal_done_(false) //构造函数，调用基类Node的构造器，节点名称为<span class="string">&quot;minimal_action_client&quot;</span>，初始化一个标记goal是否完成的布尔变量为false。</span></span><br><span class="line"><span class="function">  &#123;</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;client_ptr_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Fibonacci&gt;(</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_base_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_graph_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_logging_interface</span>(),</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_node_waitables_interface</span>(),<span class="comment">//获取接口</span></span><br><span class="line">      <span class="string">&quot;fibonacci&quot;</span>);   <span class="comment">//创建一个Fibonacci类型的Action客户端，绑定所需节点接口，并以&quot;fibonacci&quot;作为Action名字（需与服务器端一致）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(</span><br><span class="line">      std::chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionClient::send_goal, <span class="keyword">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">is_goal_done</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;goal_done_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">send_goal</span><span class="params">()</span> <span class="comment">//send_goal()函数：取消定时器（避免重复调用）、设置Goal未完成状态。</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;timer_-&gt;<span class="built_in">cancel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;goal_done_ = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;client_ptr_) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Action client not initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;client_ptr_-&gt;<span class="built_in">wait_for_action_server</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">10</span>))) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Action server not available after waiting&quot;</span>);</span><br><span class="line">      <span class="keyword">this</span>-&gt;goal_done_ = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> goal_msg = Fibonacci::<span class="built_in">Goal</span>();</span><br><span class="line">    goal_msg.order = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Sending goal&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> send_goal_options = rclcpp_action::Client&lt;Fibonacci&gt;::<span class="built_in">SendGoalOptions</span>(); <span class="comment">//初始化发送Goal时的选项结构体。</span></span><br><span class="line">    send_goal_options.goal_response_callback =    <span class="comment">//Goal响应回调：服务器接受或拒绝这个Goal</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionClient::goal_response_callback, <span class="keyword">this</span>, _1);</span><br><span class="line">    send_goal_options.feedback_callback =   <span class="comment">//反馈回调：服务器运算中返回的中间反馈</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionClient::feedback_callback, <span class="keyword">this</span>, _1, _2);</span><br><span class="line">    send_goal_options.result_callback =    <span class="comment">//结果回调：服务器完成Goal时返回结果</span></span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;MinimalActionClient::result_callback, <span class="keyword">this</span>, _1);   </span><br><span class="line">    <span class="keyword">auto</span> goal_handle_future = <span class="keyword">this</span>-&gt;client_ptr_-&gt;<span class="built_in">async_send_goal</span>(goal_msg, send_goal_options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Client&lt;Fibonacci&gt;::SharedPtr client_ptr_;</span><br><span class="line">  rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">  <span class="type">bool</span> goal_done_;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">goal_response_callback</span><span class="params">(std::shared_future&lt;GoalHandleFibonacci::SharedPtr&gt; future)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> goal_handle = future.<span class="built_in">get</span>();</span><br><span class="line">    <span class="keyword">if</span> (!goal_handle) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was rejected by server&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal accepted by server, waiting for result&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">feedback_callback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    GoalHandleFibonacci::SharedPtr,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::shared_ptr&lt;<span class="type">const</span> Fibonacci::Feedback&gt; feedback)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(</span><br><span class="line">      <span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),</span><br><span class="line">      <span class="string">&quot;Next number in sequence received: %&quot;</span> PRId32,</span><br><span class="line">      feedback-&gt;sequence.<span class="built_in">back</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">result_callback</span><span class="params">(<span class="type">const</span> GoalHandleFibonacci::WrappedResult &amp; result)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;goal_done_ = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">switch</span> (result.code) &#123;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::SUCCEEDED:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::ABORTED:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was aborted&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> rclcpp_action::ResultCode::CANCELED:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Goal was canceled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Unknown result code&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;Result received&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> number : result.result-&gt;sequence) &#123;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">&quot;%&quot;</span> PRId32, number);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;  <span class="comment">// class MinimalActionClient</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">  <span class="keyword">auto</span> action_client = std::<span class="built_in">make_shared</span>&lt;MinimalActionClient&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!action_client-&gt;<span class="built_in">is_goal_done</span>()) &#123;</span><br><span class="line">    rclcpp::<span class="built_in">spin_some</span>(action_client);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">服务端的核心代码</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *功能：创建一个Action服务器（类型为Fibonacci），名字为&quot;fibonacci&quot;</span></span><br><span class="line"><span class="comment"> *参数：传入节点接口和3个回调函数（处理Goal请求、取消请求、Goal被接受）</span></span><br><span class="line"><span class="comment"> *作用：让节点可以接收客户端的Action请求，负责执行对应逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;action_server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Fibonacci&gt;(</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_base_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_clock_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_logging_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_waitables_interface</span>(),</span><br><span class="line">  <span class="string">&quot;fibonacci&quot;</span>,</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_goal, <span class="keyword">this</span>, _1, _2),</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_cancel, <span class="keyword">this</span>, _1),</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionServer::handle_accepted, <span class="keyword">this</span>, _1));</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">客户端核心代码</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *功能：创建一个Action客户端，连接名字为&quot;fibonacci&quot;的服务器。</span></span><br><span class="line"><span class="comment"> *作用：准备向服务器发送Goal、接收反馈和结果。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">this</span>-&gt;client_ptr_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Fibonacci&gt;(</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_base_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_graph_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_logging_interface</span>(),</span><br><span class="line">  <span class="keyword">this</span>-&gt;<span class="built_in">get_node_waitables_interface</span>(),</span><br><span class="line">  <span class="string">&quot;fibonacci&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *功能：构造Goal消息，绑定响应、反馈、结果回调，异步发送Goal给服务器。</span></span><br><span class="line"><span class="comment"> *作用：正式发起Action调用，触发服务器端的执行流程。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">auto</span> goal_msg = Fibonacci::<span class="built_in">Goal</span>();</span><br><span class="line">goal_msg.order = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> send_goal_options = rclcpp_action::Client&lt;Fibonacci&gt;::<span class="built_in">SendGoalOptions</span>();</span><br><span class="line">send_goal_options.goal_response_callback =</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionClient::goal_response_callback, <span class="keyword">this</span>, _1);</span><br><span class="line">send_goal_options.feedback_callback =</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionClient::feedback_callback, <span class="keyword">this</span>, _1, _2);</span><br><span class="line">send_goal_options.result_callback =</span><br><span class="line">  std::<span class="built_in">bind</span>(&amp;MinimalActionClient::result_callback, <span class="keyword">this</span>, _1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> goal_handle_future = <span class="keyword">this</span>-&gt;client_ptr_-&gt;<span class="built_in">async_send_goal</span>(goal_msg, send_goal_options);</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h4 id="编译运行Action"><a href="#编译运行Action" class="headerlink" title="编译运行Action"></a>编译运行Action</h4><p>同编译运行节点</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>话题是单向的，而且不需要等待服务端上线，直接发就行，数据的实时性比较高。<br>频率高，实时性强的传感器数据的传递一般使用话题实现。<br>服务是双向的，客户端发送请求后，服务端有响应，可以得知服务端的处理结果。<br>频率较低，强调服务特性和反馈的场景一般使用服务实现。<br>话题适用于节点间单向的频繁的数据传输，服务则适用于节点间双向的数据传递，而参数则用于动态调整节点的设置<br>参数是节点的设置，用于配置节点，原理服务于服务<br>动作适用于需要试试反馈的场景，原理基于话题和服务</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><h3 id="接口的概念"><a href="#接口的概念" class="headerlink" title="接口的概念"></a>接口的概念</h3><p>接口其实是一种规范<br>如std_msgs&#x2F;msg&#x2F;String std_msgs&#x2F;msg&#x2F;UInt32这两种数据类型分别代表字符串和32位二进制的整型数据，是ROS2提前定义的一种规范。</p>
<p>除了参数之外，话题、服务和动作(Action)都支持自定义接口，每一种通信方式所适用的场景各不相同，所定义的接口也被分为话题接口、服务接口、动作接口三种</p>
<h3 id="接口类型"><a href="#接口类型" class="headerlink" title="接口类型"></a>接口类型</h3><p>根据引用方式不同可以分为基础类型和包装类型两类<br>基础类型有（同时后面加上[]可形成数组）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span></span><br><span class="line">byte</span><br><span class="line"><span class="type">char</span></span><br><span class="line">float32,float64</span><br><span class="line">int8,uint8</span><br><span class="line">int16,uint16</span><br><span class="line">int32,uint32</span><br><span class="line">int64,uint64</span><br><span class="line">string</span><br></pre></td></tr></table></figure>

<p>包装类型 即在已有的接口类型上进行包含</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uint32 id</span><br><span class="line">string image_name</span><br><span class="line">sensor_msgs/Image</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建接口"><a href="#创建接口" class="headerlink" title="创建接口"></a>创建接口</h3><p>话题接口格式: xxx.msg<br>服务接口格式: xxx.srv<br>动作接口格式: xxx.action</p>
<h4 id="创建话题接口"><a href="#创建话题接口" class="headerlink" title="创建话题接口"></a>创建话题接口</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">#### 创建服务接口</span><br><span class="line"></span><br><span class="line">```C++</span><br></pre></td></tr></table></figure>

<h4 id="创建动作接口"><a href="#创建动作接口" class="headerlink" title="创建动作接口"></a>创建动作接口</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">### 接口相关命令</span><br><span class="line"></span><br><span class="line">#<span class="meta"># launch文件</span></span><br><span class="line"></span><br><span class="line">launch文件允许我们同时启动和配置多个包含 ROS <span class="number">2</span> 节点的可执行文件</span><br><span class="line"></span><br><span class="line">### 创建launch文件</span><br><span class="line"></span><br><span class="line">要在每个功能包下创建launch文件</span><br><span class="line"></span><br><span class="line">### 编写launch文件</span><br><span class="line"></span><br><span class="line">首先启动是节点</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"># 导入库</span><br><span class="line">from launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line">from launch_ros.<span class="function">actions <span class="keyword">import</span> Node</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">def <span class="title">generate_launch_description</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function">    #创建LaunchDescription的对象ld（名字任意）</span></span><br><span class="line"><span class="function">    ld =</span> <span class="built_in">LaunchDescription</span>()</span><br><span class="line">    </span><br><span class="line">    #创建一个Actions.Node对象</span><br><span class="line">    example-node = <span class="built_in">Node</span>(</span><br><span class="line">    package=<span class="string">&#x27;package-name&#x27;</span>, #节点所在的功能包</span><br><span class="line">    <span class="keyword">namespace</span>=<span class="string">&#x27;package-namespace&#x27;</span>, #命名空间。如果存在同名节点，这一选项会有用</span><br><span class="line">    executable=<span class="string">&#x27;execute-name/script-name.py&#x27;</span>, #表示要运行的可执行文件名或脚本名字.py</span><br><span class="line">    parameters=[&#123;<span class="string">&#x27;parameter-name&#x27;</span>: parameter-value&#125;], #参数</span><br><span class="line">    arguments=[<span class="string">&#x27;-xxx&#x27;</span>, xxx,  <span class="string">&#x27;-xxx&#x27;</span>, xxx ], #启动参数</span><br><span class="line">    output=<span class="string">&#x27;screen&#x27;</span>, #用于将话题信息打印到屏幕</span><br><span class="line">    name=<span class="string">&#x27;node-name&#x27;</span> #表示启动后的节点名，可以没有</span><br><span class="line">    remappings=[ #重映射</span><br><span class="line">        (<span class="string">&#x27;/xxx/xxx-new&#x27;</span>, <span class="string">&#x27;/xxx/xxx-old&#x27;</span>),</span><br><span class="line"> ]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    ld.<span class="built_in">add_action</span>(example-node)</span><br><span class="line"></span><br><span class="line">    # 返回让ROS2根据launch描述执行节点</span><br><span class="line">    <span class="keyword">return</span> launch_description</span><br></pre></td></tr></table></figure>

<p>调用shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入库</span></span><br><span class="line">from launch import LaunchDescription</span><br><span class="line">from launch_ros.actions import Node</span><br><span class="line">from launch.actions import ExecuteProcess #导入新的头文件</span><br><span class="line"></span><br><span class="line">def generate_launch_description():</span><br><span class="line">    #创建LaunchDescription的对象ld（名字任意）</span><br><span class="line">    ld = LaunchDescription()</span><br><span class="line">    </span><br><span class="line">    #创建一个Actions.Node对象</span><br><span class="line">    example-node = Node(</span><br><span class="line">    package=&#x27;package-name&#x27;, #节点所在的功能包</span><br><span class="line">    namespace=&#x27;package-namespace&#x27;, #命名空间。如果存在同名节点，这一选项会有用</span><br><span class="line">    executable=&#x27;execute-name/script-name.py&#x27;, #表示要运行的可执行文件名或脚本名字.py</span><br><span class="line">    parameters=[&#123;&#x27;parameter-name&#x27;: parameter-value&#125;], #参数</span><br><span class="line">    arguments=[&#x27;-xxx&#x27;, xxx,  &#x27;-xxx&#x27;, xxx ], #启动参数</span><br><span class="line">    output=&#x27;screen&#x27;, #用于将话题信息打印到屏幕</span><br><span class="line">    name=&#x27;node-name&#x27; #表示启动后的节点名，可以没有</span><br><span class="line">    remappings=[ #重映射</span><br><span class="line">        (&#x27;/xxx/xxx-new&#x27;, &#x27;/xxx/xxx-old&#x27;),</span><br><span class="line"> ]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    #调用shell命令</span><br><span class="line">    example_cmd = ExecuteProcess(</span><br><span class="line">    cmd=[&#x27;some-cmd&#x27;, &#x27;some-cmd&#x27;], #命令，用逗号隔开</span><br><span class="line">    additional_env=&#123;&#x27;EXAMPLE_PATH&#x27;: path&#125;, #可以添加临时的环境变量</span><br><span class="line">    output=&#x27;screen&#x27;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ld.add_action(example-node)</span><br><span class="line">    ld.add_action(example_cmd) #添加</span><br><span class="line"></span><br><span class="line">    # 返回让ROS2根据launch描述执行节点</span><br><span class="line">    return launch_description</span><br></pre></td></tr></table></figure>

<h3 id="获取路径"><a href="#获取路径" class="headerlink" title="获取路径"></a>获取路径</h3><p>获取路劲有两种方式 一个是FindPackageShare 另一个是get_package_share_directory</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch_ros.substitutions <span class="keyword">import</span> FindPackageShare</span><br><span class="line">......</span><br><span class="line">package-name = ‘example-package’</span><br><span class="line">package-path = FindPackageShare(package = package-name).find(package-name) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################################</span></span><br><span class="line"><span class="keyword">from</span> ament_index_python.packages <span class="keyword">import</span> get_package_share_directory</span><br><span class="line">......</span><br><span class="line">package-name = ‘example-package’</span><br><span class="line">package-path = get_package_share_directory(package-name),</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="连接路径"><a href="#连接路径" class="headerlink" title="连接路径"></a>连接路径</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">...</span><br><span class="line"><span class="comment">#文件</span></span><br><span class="line">file-name = <span class="string">&#x27;example-file.xxx&#x27;</span></span><br><span class="line"><span class="comment">#字符串前加`f`表示可以在字符串里面使用用花括号括起来的变量和表达式，如定义好的`file-name`</span></span><br><span class="line">file-path = os.path.join(package-path, <span class="string">f&#x27;example-folder/<span class="subst">&#123;file-name&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment">#或者使用逗号隔开</span></span><br><span class="line">file-path = os.path.join(package-path, <span class="string">&#x27;example-folder&#x27;</span>, file-name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#路径</span></span><br><span class="line"><span class="built_in">dir</span>-path = os.path.join(package-path, <span class="string">&#x27;example-folder/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> launch.substitutions <span class="keyword">import</span> PathJoinSubstitution</span><br><span class="line">...</span><br><span class="line">PathJoinSubstitution([</span><br><span class="line">    FindPackageShare(<span class="string">&#x27;example-package&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;example-folder&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;example-file.xxx&#x27;</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="改变参数"><a href="#改变参数" class="headerlink" title="改变参数"></a>改变参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch.substitutions <span class="keyword">import</span> LaunchConfiguration</span><br><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> DeclareLaunchArgument</span><br><span class="line"></span><br><span class="line"><span class="comment">#LaunchConfiguration用于在变量中存储启动参数的值并将它们传递给所需的操作，允许我们在launch文件的任何部分获取启动参数的值。</span></span><br><span class="line">example-cfg = LaunchConfiguration(<span class="string">&#x27;arg-name&#x27;</span>, default=<span class="string">&#x27;true&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#DeclareLaunchArgument用于定义可以从上述启动文件或控制台传递的启动参数</span></span><br><span class="line">example-arg = DeclareLaunchArgument(</span><br><span class="line">    <span class="string">&#x27;arg-name&#x27;</span>,</span><br><span class="line">    default_value=<span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    description=<span class="string">&#x27;some description&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ld.add_action(example-arg)</span><br></pre></td></tr></table></figure>

<h3 id="嵌套使用launch文件"><a href="#嵌套使用launch文件" class="headerlink" title="嵌套使用launch文件"></a>嵌套使用launch文件</h3><p>在存在很多的单独的launch文件用于启动不同的功能的情况下，如果需要同时启动这些launch文件，可以使用IncludeLaunchDescription在launch文件中嵌套启动launch文件，这样可以提高复用率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> IncludeLaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch.launch_description_sources <span class="keyword">import</span> PythonLaunchDescriptionSource</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用IncludeLaunchDescription嵌套launch文件，其中同样可以使用上文所述的传递参数</span></span><br><span class="line">example-cfg = LaunchConfiguration(<span class="string">&#x27;arg-name&#x27;</span>, default=<span class="string">&#x27;true&#x27;</span>)</span><br><span class="line"></span><br><span class="line">another-launch = IncludeLaunchDescription(</span><br><span class="line">    PythonLaunchDescriptionSource(</span><br><span class="line">     os.path.join(launch_file_dir, <span class="string">&#x27;launch-file-name.launch.py&#x27;</span>)</span><br><span class="line">    ),</span><br><span class="line">    launch_arguments=&#123;<span class="string">&#x27;arg-name&#x27;</span>: example-arg&#125;.items()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ld.add_action(another-launch)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://wanone111.github.io">wanone111</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://wanone111.github.io/2025/09/16/ROS2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://wanone111.github.io/2025/09/16/ROS2%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://wanone111.github.io" target="_blank">Welcome to Wanone111's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ROS2/">ROS2</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/09/18/STM32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="STM32"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">STM32</div></div><div class="info-2"><div class="info-item-1">STM32标准库HAL库HAL库使用的是STM32Cubemx </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">wanone111</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wanone111"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E9%94%AE%E4%B8%8B%E8%BD%BDros%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF%E9%B1%BC%E9%A6%99ROS%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">一键下载ros，这里使用的是鱼香ROS的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCLCPP"><span class="toc-number">2.</span> <span class="toc-text">RCLCPP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">2.1.</span> <span class="toc-text">日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%EF%BC%8C%E8%AF%9D%E9%A2%98%EF%BC%8C%E6%9C%8D%E5%8A%A1-%E5%8F%82%E6%95%B0%EF%BC%8C%E5%8A%A8%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">节点，话题，服务,参数，动作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9"><span class="toc-number">3.1.</span> <span class="toc-text">节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.1.</span> <span class="toc-text">节点的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="toc-number">3.1.2.</span> <span class="toc-text">节点间的通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%8A%82%E7%82%B9"><span class="toc-number">3.1.3.</span> <span class="toc-text">创建节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%8A%82%E7%82%B9"><span class="toc-number">3.1.4.</span> <span class="toc-text">编译运行节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F"><span class="toc-number">3.1.5.</span> <span class="toc-text">节点需要注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98"><span class="toc-number">3.2.</span> <span class="toc-text">话题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.2.1.</span> <span class="toc-text">话题的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AF%9D%E9%A2%98"><span class="toc-number">3.2.2.</span> <span class="toc-text">创建话题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%AF%9D%E9%A2%98"><span class="toc-number">3.2.3.</span> <span class="toc-text">编译运行话题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F"><span class="toc-number">3.2.4.</span> <span class="toc-text">话题需要注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.3.</span> <span class="toc-text">服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.3.1.</span> <span class="toc-text">服务的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.3.2.</span> <span class="toc-text">创建服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.3.3.</span> <span class="toc-text">编译运行服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F"><span class="toc-number">3.3.4.</span> <span class="toc-text">服务需要注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.4.1.</span> <span class="toc-text">参数的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.2.</span> <span class="toc-text">参数的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.3.</span> <span class="toc-text">编译运行参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C%EF%BC%88Action%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">动作（Action）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Action%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.5.1.</span> <span class="toc-text">Action的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Action%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.2.</span> <span class="toc-text">Action的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="toc-number">3.5.3.</span> <span class="toc-text">核心代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8CAction"><span class="toc-number">3.5.4.</span> <span class="toc-text">编译运行Action</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.</span> <span class="toc-text">接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.</span> <span class="toc-text">接口的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">接口类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">创建接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AF%9D%E9%A2%98%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.1.</span> <span class="toc-text">创建话题接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E4%BD%9C%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.2.</span> <span class="toc-text">创建动作接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84"><span class="toc-number">4.4.</span> <span class="toc-text">获取路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%B7%AF%E5%BE%84"><span class="toc-number">4.5.</span> <span class="toc-text">连接路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%8F%82%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">改变参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E4%BD%BF%E7%94%A8launch%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.</span> <span class="toc-text">嵌套使用launch文件</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/16/%E7%94%B5%E8%B5%9B/" title="电赛">电赛</a><time datetime="2025-10-16T11:28:16.000Z" title="发表于 2025-10-16 19:28:16">2025-10-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/23/STM32-%E9%80%9A%E4%BF%A1/" title="STM32-通信">STM32-通信</a><time datetime="2025-09-23T13:01:21.000Z" title="发表于 2025-09-23 21:01:21">2025-09-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/23/FPGA-ZYNQ/" title="FPGA-ZYNQ">FPGA-ZYNQ</a><time datetime="2025-09-23T12:31:25.000Z" title="发表于 2025-09-23 20:31:25">2025-09-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/23/FPGA-PYNQ/" title="FPGA-PYNQ">FPGA-PYNQ</a><time datetime="2025-09-23T11:49:01.000Z" title="发表于 2025-09-23 19:49:01">2025-09-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/19/FPGA%E6%AF%94%E8%B5%9B/" title="FPGA比赛">FPGA比赛</a><time datetime="2025-09-19T13:55:30.000Z" title="发表于 2025-09-19 21:55:30">2025-09-19</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By wanone111</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>